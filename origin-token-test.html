<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chrome AI Origin Token Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 40px; }
        .token { background: #f5f5f5; padding: 10px; margin: 10px 0; border-radius: 5px; }
        .status { padding: 5px 10px; border-radius: 3px; margin: 5px 0; }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
    </style>
</head>
<body>
    <h1>Chrome AI Origin Token Test</h1>
    <div id="results"></div>
    
    <script>
        function testOriginTokens() {
            const results = document.getElementById('results');
            const originTrials = document.querySelectorAll('meta[http-equiv="origin-trial"]');
            
            results.innerHTML = '<h2>Origin Token Validation Results:</h2>';
            
            originTrials.forEach((meta, index) => {
                const token = meta.getAttribute('content');
                const tokenDiv = document.createElement('div');
                tokenDiv.className = 'token';
                
                try {
                    const decodedToken = atob(token);
                    const tokenData = JSON.parse(decodedToken);
                    
                    const isExpired = tokenData.expiry * 1000 < Date.now();
                    const statusClass = isExpired ? 'error' : 'success';
                    const statusText = isExpired ? 'EXPIRED' : 'ACTIVE';
                    
                    tokenDiv.innerHTML = `
                        <div class="status ${statusClass}">Token ${index + 1}: ${statusText}</div>
                        <strong>Feature:</strong> ${tokenData.feature}<br>
                        <strong>Origin:</strong> ${tokenData.origin}<br>
                        <strong>Expires:</strong> ${new Date(tokenData.expiry * 1000).toLocaleDateString()}<br>
                        <strong>Subdomain:</strong> ${tokenData.isSubdomain ? 'Yes' : 'No'}
                    `;
                } catch (error) {
                    tokenDiv.innerHTML = `
                        <div class="status error">Token ${index + 1}: INVALID</div>
                        <strong>Error:</strong> ${error.message}
                    `;
                }
                
                results.appendChild(tokenDiv);
            });
            
            // Test Chrome AI availability
            const aiStatus = document.createElement('div');
            aiStatus.className = 'token';
            
            const chromeAI = ('ai' in self ? self.ai : undefined);
            if (chromeAI) {
                aiStatus.innerHTML = `
                    <div class="status success">Chrome AI APIs Available</div>
                    <strong>Summarizer:</strong> ${chromeAI.summarizer ? '✅' : '❌'}<br>
                    <strong>Translator:</strong> ${chromeAI.translator ? '✅' : '❌'}<br>
                    <strong>Writer:</strong> ${chromeAI.writer ? '✅' : '❌'}<br>
                    <strong>Language Model:</strong> ${chromeAI.languageModel ? '✅' : '❌'}
                `;
            } else {
                aiStatus.innerHTML = '<div class="status error">Chrome AI APIs Not Available</div>';
            }
            
            results.appendChild(aiStatus);
        }
        
        window.addEventListener('DOMContentLoaded', testOriginTokens);
    </script>
</body>
</html>