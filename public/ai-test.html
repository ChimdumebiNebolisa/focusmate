<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chrome AI API Test</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .card {
            background: white;
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        h1 {
            color: #1a73e8;
            margin: 0 0 10px 0;
        }
        .status {
            font-size: 14px;
            padding: 8px 12px;
            border-radius: 6px;
            display: inline-block;
            margin: 5px 5px 5px 0;
        }
        .status.success {
            background: #d4edda;
            color: #155724;
        }
        .status.error {
            background: #f8d7da;
            color: #721c24;
        }
        .status.warning {
            background: #fff3cd;
            color: #856404;
        }
        button {
            background: #1a73e8;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            margin: 5px 5px 5px 0;
        }
        button:hover {
            background: #1557b0;
        }
        button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        pre {
            background: #f5f5f5;
            padding: 12px;
            border-radius: 6px;
            overflow-x: auto;
            font-size: 12px;
        }
        .hidden {
            display: none;
        }
        textarea {
            width: 100%;
            min-height: 100px;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-family: inherit;
            resize: vertical;
        }
    </style>
</head>
<body>
    <div class="card">
        <h1>ü§ñ Chrome Built-in AI API Test</h1>
        <p>This page helps you check if Chrome's Built-in AI APIs are available and working.</p>
    </div>

    <div class="card">
        <h2>üìã Browser Information</h2>
        <div id="browserInfo"></div>
    </div>

    <div class="card">
        <h2>üîç API Availability</h2>
        <div id="apiStatus"></div>
        <button onclick="checkAPIs()">üîÑ Recheck APIs</button>
    </div>

    <div class="card" id="testCard" class="hidden">
        <h2>üß™ Test AI Functions</h2>
        <div style="margin-bottom: 15px;">
            <textarea id="testInput" placeholder="Enter some text to test AI features...">Chrome's Built-in AI APIs provide powerful on-device machine learning capabilities including text generation, summarization, writing assistance, and translation. These features run locally on your device without sending data to the cloud, ensuring privacy and fast response times.</textarea>
        </div>
        <button onclick="testLanguageModel()">üí¨ Test Language Model</button>
        <button onclick="testSummarizer()">üìù Test Summarizer</button>
        <button onclick="testWriter()">‚úçÔ∏è Test Writer</button>
        <button onclick="testTranslator()">üåç Test Translator</button>
        <div id="testResults"></div>
    </div>

    <div class="card">
        <h2>üìö Setup Instructions</h2>
        <ol>
            <li><strong>Use Chrome Dev or Canary</strong> (version 127+)
                <ul>
                    <li><a href="https://www.google.com/chrome/dev/" target="_blank">Download Chrome Dev</a></li>
                    <li><a href="https://www.google.com/chrome/canary/" target="_blank">Download Chrome Canary</a></li>
                </ul>
            </li>
            <li><strong>Enable Chrome Flags</strong> at <code>chrome://flags</code>:
                <ul>
                    <li><code>#optimization-guide-on-device-model</code></li>
                    <li><code>#prompt-api-for-gemini-nano</code></li>
                    <li><code>#summarization-api-for-gemini-nano</code></li>
                    <li><code>#writer-api-for-gemini-nano</code></li>
                    <li><code>#translation-api</code></li>
                </ul>
            </li>
            <li><strong>Download AI Model</strong> at <code>chrome://components</code>:
                <ul>
                    <li>Find "Optimization Guide On Device Model"</li>
                    <li>Click "Check for update"</li>
                    <li>Wait for download (~2GB)</li>
                </ul>
            </li>
            <li><strong>Restart Chrome</strong> completely</li>
            <li><strong>Return to this page</strong> and click "Recheck APIs"</li>
        </ol>
    </div>

    <script>
        // Display browser info
        function displayBrowserInfo() {
            const info = {
                userAgent: navigator.userAgent,
                platform: navigator.platform,
                language: navigator.language,
                isChrome: /Chrome/.test(navigator.userAgent) && !/Edg/.test(navigator.userAgent),
            };
            
            let html = '<pre>' + JSON.stringify(info, null, 2) + '</pre>';
            document.getElementById('browserInfo').innerHTML = html;
        }

        // Check API availability
        async function checkAPIs() {
            const statusDiv = document.getElementById('apiStatus');
            statusDiv.innerHTML = '<p>Checking APIs...</p>';

            // Access the global 'ai' object (NOT window.ai - that's deprecated)
            const globalAI = (typeof ai !== 'undefined' ? ai : self.ai);
            
            const results = {
                globalAI: !!globalAI,
                apis: {}
            };

            if (globalAI) {
                results.apis.languageModel = !!globalAI.languageModel;
                results.apis.summarizer = !!globalAI.summarizer;
                results.apis.writer = !!globalAI.writer;
                results.apis.translator = !!globalAI.translator;

                // Check capabilities
                if (globalAI.languageModel) {
                    try {
                        const caps = await globalAI.languageModel.capabilities();
                        results.languageModelCapabilities = caps;
                    } catch (e) {
                        results.languageModelError = e.message;
                    }
                }
            }

            // Display results
            let html = '';
            
            if (results.globalAI) {
                html += '<div class="status success">‚úÖ Chrome Built-in AI is available!</div><br>';
                Object.entries(results.apis).forEach(([api, available]) => {
                    html += `<div class="status ${available ? 'success' : 'error'}">${available ? '‚úÖ' : '‚ùå'} ${api}</div>`;
                });
                
                if (results.languageModelCapabilities) {
                    html += '<br><strong>Language Model Capabilities:</strong>';
                    html += '<pre>' + JSON.stringify(results.languageModelCapabilities, null, 2) + '</pre>';
                }

                document.getElementById('testCard').classList.remove('hidden');
            } else {
                html += '<div class="status error">‚ùå Chrome Built-in AI is NOT available</div><br>';
                html += '<p>‚ö†Ô∏è The Chrome Built-in AI APIs are not detected. Please follow the setup instructions below.</p>';
                document.getElementById('testCard').classList.add('hidden');
            }

            statusDiv.innerHTML = html;
            console.log('AI Check Results:', results);
        }

        // Test functions
        async function testLanguageModel() {
            const input = document.getElementById('testInput').value;
            const resultsDiv = document.getElementById('testResults');
            resultsDiv.innerHTML = '<p>‚è≥ Testing Language Model API...</p>';

            try {
                const globalAI = (typeof ai !== 'undefined' ? ai : self.ai);
                const model = await globalAI.languageModel.create({
                    systemPrompt: 'You are a helpful assistant.'
                });
                const result = await model.prompt(`Analyze this text: ${input}`);
                resultsDiv.innerHTML = `<h3>Language Model Result:</h3><pre>${result}</pre>`;
            } catch (error) {
                resultsDiv.innerHTML = `<div class="status error">‚ùå Error: ${error.message}</div>`;
            }
        }

        async function testSummarizer() {
            const input = document.getElementById('testInput').value;
            const resultsDiv = document.getElementById('testResults');
            resultsDiv.innerHTML = '<p>‚è≥ Testing Summarizer API...</p>';

            try {
                const globalAI = (typeof ai !== 'undefined' ? ai : self.ai);
                const summarizer = await globalAI.summarizer.create({
                    type: 'key-points',
                    format: 'plain-text',
                    length: 'medium'
                });
                const result = await summarizer.summarize(input);
                resultsDiv.innerHTML = `<h3>Summarizer Result:</h3><pre>${result}</pre>`;
            } catch (error) {
                resultsDiv.innerHTML = `<div class="status error">‚ùå Error: ${error.message}</div>`;
            }
        }

        async function testWriter() {
            const input = document.getElementById('testInput').value;
            const resultsDiv = document.getElementById('testResults');
            resultsDiv.innerHTML = '<p>‚è≥ Testing Writer API...</p>';

            try {
                const globalAI = (typeof ai !== 'undefined' ? ai : self.ai);
                const writer = await globalAI.writer.create({
                    tone: 'neutral',
                    format: 'plain-text'
                });
                const result = await writer.write(input, { 
                    context: 'Rewrite this text to be clearer and more professional.' 
                });
                resultsDiv.innerHTML = `<h3>Writer Result:</h3><pre>${result}</pre>`;
            } catch (error) {
                resultsDiv.innerHTML = `<div class="status error">‚ùå Error: ${error.message}</div>`;
            }
        }

        async function testTranslator() {
            const input = document.getElementById('testInput').value;
            const resultsDiv = document.getElementById('testResults');
            resultsDiv.innerHTML = '<p>‚è≥ Testing Translator API...</p>';

            try {
                const globalAI = (typeof ai !== 'undefined' ? ai : self.ai);
                const translator = await globalAI.translator.create({
                    sourceLanguage: 'en',
                    targetLanguage: 'es'
                });
                const result = await translator.translate(input);
                resultsDiv.innerHTML = `<h3>Translator Result (Spanish):</h3><pre>${result}</pre>`;
            } catch (error) {
                resultsDiv.innerHTML = `<div class="status error">‚ùå Error: ${error.message}</div>`;
            }
        }

        // Initialize on page load
        window.addEventListener('DOMContentLoaded', () => {
            displayBrowserInfo();
            checkAPIs();
        });
    </script>
</body>
</html>

